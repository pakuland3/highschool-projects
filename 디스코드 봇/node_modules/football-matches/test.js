const { existsSync } = require('fs')
const test = require('ava')
const m = require('.')

let apiKey
if (existsSync(`${__dirname}/.env`)) {
  apiKey = require('./.env').apiKey
} else {
  apiKey = process.env.API_KEY
}

test('Returns matches for Real Madrid', async t => {
  const matches = await m('real-madrid', {apiKey})
  t.true(Array.isArray(matches))
})

test('Will not return matches for Barcelona', async t => {
  const err = await t.throws(m('barcelona', {apiKey}))
  t.regex(err.message, /unknown team/i)
})

test('Returns only new matches', async t => {
  const matches = await m('real madrid', {apiKey})
  for (const match of matches) {
    if (match.status === m.PLAYED) {
      t.fail()
    }
  }
  t.pass()
})

test('Throws error without API key', async t => {
  const err = await t.throws(m('real madrid'))
  t.regex(err.message, /provide an api key/i)
})
